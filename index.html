<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Attendance Sheet</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Montserrat -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
        }
        /* Custom styles for the document icon (SVG) */
        .document-icon {
            width: 48px;
            height: 48px;
            fill: #f59e0b; /* Tailwind amber-500 */
        }
        /* Active state for student type buttons */
        .student-type-button.active {
            background-color: #2563eb; /* Tailwind blue-700 */
            color: white;
        }
        /* Message display styling */
        .message-display {
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.875rem; /* text-sm */
            font-weight: 500; /* font-medium */
            display: none; /* Hidden by default */
        }
        .message-display.success {
            background-color: #d1fae5; /* Tailwind green-100 */
            color: #065f46; /* Tailwind green-800 */
            border: 1px solid #34d399; /* Tailwind green-400 */
        }
        .message-display.error {
            background-color: #fee2e2; /* Tailwind red-100 */
            color: #991b1b; /* Tailwind red-800 */
            border: 1px solid #f87171; /* Tailwind red-400 */
        }
        /* Attendance Button Styling */
        .attendance-btn {
            padding: 0.25rem 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.75rem; /* text-xs */
            font-weight: 600; /* font-semibold */
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
            cursor: pointer;
            border: none;
            outline: none;
        }
        .attendance-btn.present {
            background-color: #10b981; /* Tailwind green-500 */
            color: white;
        }
        .attendance-btn.missed {
            background-color: #ef4444; /* Tailwind red-500 */
            color: white;
        }
        /* Neutral state for attendance buttons in modal */
        .attendance-btn.neutral {
            background-color: #e5e7eb; /* Tailwind gray-200 */
            color: #4b5563; /* Tailwind gray-700 */
        }

        /* Modal specific styles */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 90%;
            max-width: 500px;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
            margin-top: 1rem;
        }
    </style>
</head>
<body class="p-4 sm:p-6 lg:p-8">
    <div class="max-w-7xl mx-auto bg-white rounded-xl shadow-lg p-6 sm:p-8 lg:p-10">
        <!-- Header Section -->
        <header class="text-center mb-8">
            <div class="flex justify-center mb-4">
                <!-- Document Icon (SVG) -->
                <svg class="document-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm-1 7V3.5L18.5 9H13z"/>
                </svg>
            </div>
            <h1 class="text-3xl sm:text-4xl font-semibold text-gray-800 mb-2">Student Attendance Sheet</h1>
            <p class="text-gray-600 text-sm sm:text-base">Track student attendance with ease - Simple, Fast, Reliable</p>
        </header>

        <!-- Time Display Section -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8 max-w-lg mx-auto">
            <div class="bg-gray-100 p-4 rounded-lg shadow-sm text-center">
                <p class="text-gray-600 text-sm mb-1">Philippines Time</p>
                <p class="text-2xl font-bold text-gray-800" id="philippines-time">00:00:00 PM</p>
            </div>
            <div class="bg-gray-100 p-4 rounded-lg shadow-sm text-center">
                <p class="text-gray-600 text-sm mb-1">Israel Time</p>
                <p class="text-2xl font-bold text-gray-800" id="israel-time">00:00:00 AM</p>
            </div>
        </div>

        <!-- Date Navigation and Controls -->
        <div class="flex flex-col md:flex-row items-center justify-between mb-6 p-4 bg-white rounded-lg shadow-sm border border-gray-200">
            <div class="flex items-center space-x-2 mb-4 md:mb-0">
                <button class="p-2 rounded-full hover:bg-gray-200 transition-colors">
                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                </button>
                <span class="text-lg font-medium text-gray-800">July</span>
                <span class="text-lg font-medium text-gray-800">2025</span>
                <button class="p-2 rounded-full hover:bg-gray-200 transition-colors">
                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                </button>
            </div>
            <div class="text-gray-700 text-base font-medium mb-4 md:mb-0">Date: Tue, Jul 22, 2025</div>
            <div class="flex items-center space-x-4">
                <label class="flex items-center cursor-pointer">
                    <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600 rounded">
                    <span class="ml-2 text-gray-700 text-sm">Cut-off Period</span>
                </label>
                <select class="form-select border border-gray-300 rounded-md py-1 px-2 text-gray-700 text-sm focus:ring-blue-500 focus:border-blue-500">
                    <option>Second Half</option>
                    <option>First Half</option>
                </select>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-wrap justify-center sm:justify-start gap-3 mb-8">
            <button class="flex items-center bg-yellow-500 hover:bg-yellow-600 text-white font-medium py-2 px-4 rounded-lg shadow-md transition-colors text-sm">
                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path><path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"></path></svg>
                Export CSV
            </button>
            <button class="flex items-center bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg shadow-md transition-colors text-sm">
                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M5 4v3H4a2 2 0 00-2 2v5a2 2 0 002 2h12a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm2 5h6V4H7v5z" clip-rule="evenodd"></path></svg>
                Print
            </button>
            <button id="clearAllBtn" class="flex items-center bg-red-500 hover:bg-red-600 text-white font-medium py-2 px-4 rounded-lg shadow-md transition-colors text-sm">
                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 000-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 11-2 0v6a1 1 0 112 0V8z" clip-rule="evenodd"></path></svg>
                Clear All
            </button>
            <button class="flex items-center bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-lg shadow-md transition-colors text-sm">
                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
                Manage Schedules
            </button>
            <button class="flex items-center bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-lg shadow-md transition-colors text-sm">
                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17.555 17.08a1 1 0 00-.632-.897l-1.668-.417a1 1 0 00-.97-.008l-2.67 1.335a1 1 0 01-1.123-.11l-2.67-2.67a1 1 0 00-1.118-.112l-2.67 1.335a1 1 0 01-.97.008l-1.668.417a1 1 0 00-.632.897C.868 18.232 2.458 19 4 19h12c1.542 0 3.132-.768 3.555-1.92z" clip-rule="evenodd"></path></svg>
                View All Students
            </button>
        </div>

        <!-- Student Entry Section (for adding new students) -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-4 items-end">
            <input type="text" id="studentNameInput" placeholder="Enter student name..." class="col-span-1 md:col-span-2 lg:col-span-1 p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm">
            <input type="text" id="studentIdInput" placeholder="Student ID (e.g., #1234 or 1234)" class="col-span-1 md:col-span-2 lg:col-span-1 p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm">
            <div class="flex items-center space-x-4 col-span-1 lg:col-span-1">
                <!-- Student Type Buttons -->
                <button id="regularStudentBtn" class="student-type-button bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-lg shadow-md transition-colors text-sm">
                    Regular Student
                </button>
                <button id="trialStudentBtn" class="student-type-button bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-lg shadow-md transition-colors text-sm">
                    Trial Student
                </button>
            </div>
            <!-- Removed time inputs from here, as they are now in the edit modal -->
            <button id="addStudentBtn" class="col-span-1 lg:col-span-1 bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-lg shadow-md transition-colors text-sm">
                Add Student
            </button>
            <button id="manualEntryBtn" class="col-span-1 lg:col-span-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-3 px-4 rounded-lg shadow-md transition-colors text-sm">
                Manual Entry
            </button>
        </div>
        <!-- Message Display Area -->
        <div id="messageDisplay" class="message-display"></div>

        <!-- Statistical Cards Section -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
            <!-- Card 1: Total Students (Cut-off Period) -->
            <div class="bg-gray-50 p-6 rounded-lg shadow-md border border-gray-200 text-center">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Total Students (Cut-off Period)</h3>
                <div class="text-gray-600 text-sm space-y-1 mb-4">
                    <p>AM Shift: <span class="font-medium">0</span></p>
                    <p>PM Shift: <span class="font-medium">0</span></p>
                    <p>Night Shift: <span class="font-medium">0</span></p>
                </div>
                <div class="text-xl font-bold text-gray-900 border-t pt-3 border-gray-200">Grand Total: <span class="text-blue-600">0</span></div>
            </div>

            <!-- Card 2: Daily Present Students -->
            <div class="bg-green-50 p-6 rounded-lg shadow-md border border-green-200 text-center">
                <h3 class="text-lg font-semibold text-green-800 mb-4">Daily Present Students<br>(Tue, Jul 22, 2025)</h3>
                <div class="text-gray-600 text-sm space-y-1 mb-4">
                    <p>AM Shift: <span class="font-medium">0</span></p>
                    <p>PM Shift: <span class="font-medium">0</span></p>
                    <p>Night Shift: <span class="font-medium">0</span></p>
                </div>
                <div class="text-xl font-bold text-gray-900 border-t pt-3 border-green-200">Grand Total: <span class="text-green-600">0</span></div>
            </div>

            <!-- Card 3: Daily Absent Students -->
            <div class="bg-red-50 p-6 rounded-lg shadow-md border border-red-200 text-center">
                <h3 class="text-lg font-semibold text-red-800 mb-4">Daily Absent Students<br>(Tue, Jul 22, 2025)</h3>
                <div class="text-gray-600 text-sm space-y-1 mb-4">
                    <p>AM Shift: <span class="font-medium">0</span></p>
                    <p>PM Shift: <span class="font-medium">0</span></p>
                    <p>Night Shift: <span class="font-medium">0</span></p>
                </div>
                <div class="text-xl font-bold text-gray-900 border-t pt-3 border-red-200">Grand Total: <span class="text-red-600">0</span></div>
            </div>

            <!-- Card 4: Total Daily Students -->
            <div class="bg-gray-50 p-6 rounded-lg shadow-md border border-gray-200 text-center">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Total Daily Students<br>(Tue, Jul 22, 2025)</h3>
                <div class="text-gray-600 text-sm space-y-1 mb-4">
                    <p>AM Shift: <span class="font-medium">0</span></p>
                    <p>PM Shift: <span class="font-medium">0</span></p>
                    <p>Night Shift: <span class="font-medium">0</span></p>
                </div>
                <div class="text-xl font-bold text-gray-900 border-t pt-3 border-gray-200">Grand Total: <span class="text-blue-600">0</span></div>
            </div>

            <!-- Card 5: Registered Total Student -->
            <div class="bg-gray-50 p-6 rounded-lg shadow-md border border-gray-200 text-center">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Registered Total Student<br>(Selected Year)</h3>
                <div class="text-5xl font-bold text-blue-600 mb-4">0</div>
                <div class="text-gray-600 text-sm"></div>
            </div>
        </div>

        <!-- Footer/Status Bar -->
        <div class="flex flex-col sm:flex-row items-center justify-center sm:justify-start bg-gray-100 p-4 rounded-lg shadow-sm text-sm text-gray-700 font-medium space-y-2 sm:space-y-0 sm:space-x-8 mb-8">
            <div>RUNNING TIME: <span class="font-bold text-gray-900" id="running-time">00:00</span></div>
            <div>STATUS: <span class="font-bold text-red-600" id="status-message">NO ACTIVE STUDENT</span></div>
        </div>

        <!-- OFF SHIFT Card -->
        <div class="flex justify-center mb-8">
            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 text-center max-w-sm w-full">
                <button class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-6 rounded-lg shadow-md transition-colors mb-4 text-lg">
                    OFF SHIFT
                </button>
                <div class="text-left text-gray-700 space-y-2 text-base">
                    <p><span class="font-semibold">Student Name:</span> <span id="currentStudentName"></span></p>
                    <p><span class="font-semibold">Student ID:</span> <span id="currentStudentId"></span></p>
                    <p><span class="font-semibold">Student Type:</span> <span id="currentStudentType"></span></p>
                    <p><span class="font-semibold">Start Time:</span> <span id="currentStartTime"></span></p>
                </div>
            </div>
        </div>

        <!-- Student Data Table Section -->
        <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider rounded-tl-lg">#</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Student Type</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time Duration</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Student Name</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Student ID</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Scheduled Time</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Shift</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Attendance</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider rounded-tr-lg">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="studentTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Placeholder for no students -->
                        <tr id="noStudentsRow">
                            <td colspan="9" class="px-6 py-12 whitespace-nowrap text-center text-gray-500">
                                <div class="flex flex-col items-center justify-center">
                                    <!-- Group Icon (SVG) -->
                                    <svg class="w-16 h-16 text-gray-300 mb-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path></svg>
                                    <p class="text-lg font-medium">No students added yet</p>
                                    <p class="text-sm">Add your first student using the form above</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal HTML -->
    <div id="confirmationModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Confirm Deletion</h3>
            <p class="text-gray-700">Are you sure you want to delete this student record?</p>
            <div class="modal-footer">
                <button id="cancelDeleteBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-medium py-2 px-4 rounded-lg shadow-md transition-colors">Cancel</button>
                <button id="confirmDeleteBtn" class="bg-red-500 hover:bg-red-600 text-white font-medium py-2 px-4 rounded-lg shadow-md transition-colors">Delete</button>
            </div>
        </div>
    </div>

    <!-- Edit Student Modal HTML -->
    <div id="editStudentModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Edit Student Information</h3>
            <div class="grid grid-cols-1 gap-4">
                <div>
                    <label for="editModalStudentName" class="block text-sm font-medium text-gray-700 mb-1">Student Name:</label>
                    <input type="text" id="editModalStudentName" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm">
                </div>
                <div>
                    <label for="editModalStudentId" class="block text-sm font-medium text-gray-700 mb-1">Student ID:</label>
                    <input type="text" id="editModalStudentId" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Student Type:</label>
                    <div class="flex space-x-2">
                        <button id="editModalRegularStudentBtn" class="student-type-button bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-lg shadow-md transition-colors text-sm">
                            Regular Student
                        </button>
                        <button id="editModalTrialStudentBtn" class="student-type-button bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-lg shadow-md transition-colors text-sm">
                            Trial Student
                        </button>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Time Start:</label>
                        <div class="flex items-center space-x-2">
                            <input type="number" id="editModalStartTimeHour" placeholder="HH" min="1" max="12" class="w-16 p-2 border border-gray-300 rounded-lg text-sm">
                            <span class="text-gray-500">:</span>
                            <input type="number" id="editModalStartTimeMinute" placeholder="MM" min="0" max="59" class="w-16 p-2 border border-gray-300 rounded-lg text-sm">
                            <select id="editModalStartTimeAmpm" class="p-2 border border-gray-300 rounded-lg text-sm">
                                <option value="AM">AM</option>
                                <option value="PM">PM</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Time End:</label>
                        <div class="flex items-center space-x-2">
                            <input type="number" id="editModalEndTimeHour" placeholder="HH" min="1" max="12" class="w-16 p-2 border border-gray-300 rounded-lg text-sm">
                            <span class="text-gray-500">:</span>
                            <input type="number" id="editModalEndTimeMinute" placeholder="MM" min="0" max="59" class="w-16 p-2 border border-gray-300 rounded-lg text-sm">
                            <select id="editModalEndTimeAmpm" class="p-2 border border-gray-300 rounded-lg text-sm">
                                <option value="AM">AM</option>
                                <option value="PM">PM</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Attendance:</label>
                    <div class="flex space-x-2">
                        <button id="editModalPresentBtn" class="attendance-btn neutral">Present</button>
                        <button id="editModalMissedBtn" class="attendance-btn neutral">Missed</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelEditBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-medium py-2 px-4 rounded-lg shadow-md transition-colors">Cancel</button>
                <button id="submitEditBtn" class="bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg shadow-md transition-colors">Submit Changes</button>
            </div>
        </div>
    </div>

    <script>
        // Global utility functions (defined outside DOMContentLoaded for wider accessibility)
        function showMessage(message, type) {
            const messageDisplay = document.getElementById('messageDisplay');
            if (messageDisplay) {
                messageDisplay.textContent = message;
                messageDisplay.className = `message-display ${type}`;
                messageDisplay.style.display = 'block';
                setTimeout(() => {
                    messageDisplay.style.display = 'none';
                }, 3000);
            } else {
                console.error("Message display element not found!");
            }
        }

        function getScheduledTime() {
            const now = new Date();
            let hours = now.getHours();
            let minutes = now.getMinutes();

            if (minutes >= 0 && minutes < 15) {
                minutes = 0;
            } else if (minutes >= 15 && minutes < 45) {
                minutes = 30;
            } else {
                minutes = 0;
                hours++;
            }

            const ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12;
            hours = hours ? hours : 12;

            const formattedMinutes = minutes < 10 ? '0' + minutes : minutes;
            return `${hours}:${formattedMinutes} ${ampm}`;
        }

        // Function for student type button selection (for both add and edit forms)
        let selectedStudentType = ''; // Declare globally for the add form
        let currentEditModalStudentType = ''; // Declare globally for the edit modal
        function selectStudentType(selectedButton, type, isModal = false) {
            let regularBtn, trialBtn;
            if (isModal) {
                regularBtn = document.getElementById('editModalRegularStudentBtn');
                trialBtn = document.getElementById('editModalTrialStudentBtn');
            } else {
                regularBtn = document.getElementById('regularStudentBtn');
                trialBtn = document.getElementById('trialStudentBtn');
            }

            if (regularBtn) {
                regularBtn.classList.remove('active', 'bg-blue-500', 'text-white');
                regularBtn.classList.add('bg-gray-200', 'text-gray-800');
            }
            if (trialBtn) {
                trialBtn.classList.remove('active', 'bg-blue-500', 'text-white');
                trialBtn.classList.add('bg-gray-200', 'text-gray-800');
            }
            
            if (selectedButton) {
                selectedButton.classList.add('active', 'bg-blue-500', 'text-white');
                selectedButton.classList.remove('bg-gray-200', 'text-gray-800');
            }

            if (isModal) {
                currentEditModalStudentType = type;
            } else {
                selectedStudentType = type;
            }
            showMessage(`${type} selected!`, 'success');
        }

        // Function to select attendance status in the modal
        let currentEditModalAttendanceStatus = 'Present'; // Initialize
        function selectModalAttendanceStatus(selectedButton, status) {
            const presentBtn = document.getElementById('editModalPresentBtn');
            const missedBtn = document.getElementById('editModalMissedBtn');

            // Reset both buttons to neutral state first
            if (presentBtn) {
                presentBtn.classList.remove('present', 'missed');
                presentBtn.classList.add('neutral');
            }
            if (missedBtn) {
                missedBtn.classList.remove('present', 'missed');
                missedBtn.classList.add('neutral');
            }

            // Apply selected status styling
            if (selectedButton) {
                if (status === 'Present') {
                    selectedButton.classList.remove('neutral', 'missed');
                    selectedButton.classList.add('present');
                } else if (status === 'Missed') {
                    selectedButton.classList.remove('neutral', 'present');
                    selectedButton.classList.add('missed');
                }
            }
            currentEditModalAttendanceStatus = status;
        }


        // Function to validate time inputs in the modal
        function validateModalTime(hour, minute, ampm, type) {
            const h = parseInt(hour);
            const m = parseInt(minute);

            if (isNaN(h) || h < 1 || h > 12) {
                return { isValid: false, message: 'Hour must be between 1 and 12.' };
            }
            if (isNaN(m) || m < 0 || m > 59) {
                return { isValid: false, message: 'Minute must be between 00 and 59.' };
            }

            if (type === 'start') {
                if (m === 0 || m === 30) {
                    return { isValid: false, message: 'Start Time minutes must not be 00 or 30.' };
                }
            } else if (type === 'end') {
                if (m === 0) {
                    return { isValid: false, message: 'End Time minutes must not be 00.' };
                }
            }

            return { isValid: true, formattedTime: `${h}:${String(m).padStart(2, '0')} ${ampm}` };
        }


        document.addEventListener('DOMContentLoaded', () => {
            // Global variables (still inside DOMContentLoaded for proper scope)
            let studentCounter = 0;
            let editingRow = null; // Stores the <tr> element being edited

            // Get references to elements (main form)
            const regularStudentBtn = document.getElementById('regularStudentBtn');
            const trialStudentBtn = document.getElementById('trialStudentBtn');
            const studentNameInput = document.getElementById('studentNameInput');
            const studentIdInput = document.getElementById('studentIdInput');
            const addStudentBtn = document.getElementById('addStudentBtn');
            const manualEntryBtn = document.getElementById('manualEntryBtn');
            const clearAllBtn = document.getElementById('clearAllBtn');
            const studentTableBody = document.getElementById('studentTableBody');
            const noStudentsRow = document.getElementById('noStudentsRow');
            // messageDisplay is global now

            // References for OFF SHIFT card student details
            const currentStudentNameSpan = document.getElementById('currentStudentName');
            const currentStudentIdSpan = document.getElementById('currentStudentId');
            const currentStudentTypeSpan = document.getElementById('currentStudentType');
            const currentStartTimeSpan = document.getElementById('currentStartTime');

            // Modal elements (Confirmation Modal)
            const confirmationModal = document.getElementById('confirmationModal');
            const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
            const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
            let rowToDelete = null; // To store the row clicked for deletion

            // Modal elements (Edit Student Modal)
            const editStudentModal = document.getElementById('editStudentModal');
            const editModalStudentName = document.getElementById('editModalStudentName');
            const editModalStudentId = document.getElementById('editModalStudentId');
            const editModalRegularStudentBtn = document.getElementById('editModalRegularStudentBtn');
            const editModalTrialStudentBtn = document.getElementById('editModalTrialStudentBtn');
            const editModalStartTimeHour = document.getElementById('editModalStartTimeHour');
            const editModalStartTimeMinute = document.getElementById('editModalStartTimeMinute');
            const editModalStartTimeAmpm = document.getElementById('editModalStartTimeAmpm');
            const editModalEndTimeHour = document.getElementById('editModalEndTimeHour');
            const editModalEndTimeMinute = document.getElementById('editModalEndTimeMinute');
            const editModalEndTimeAmpm = document.getElementById('editModalEndTimeAmpm');
            const editModalPresentBtn = document.getElementById('editModalPresentBtn');
            const editModalMissedBtn = document.getElementById('editModalMissedBtn');
            const submitEditBtn = document.getElementById('submitEditBtn');
            const cancelEditBtn = document.getElementById('cancelEditBtn');


            // Function to update time dynamically (for header)
            function updateHeaderTime() {
                const now = new Date();

                // Philippines Time (GMT+8)
                const phTime = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Manila' }));
                const philippinesTimeElement = document.getElementById('philippines-time');
                if (philippinesTimeElement) {
                    philippinesTimeElement.textContent = phTime.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true });
                }

                // Israel Time (GMT+3)
                const ilTime = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Jerusalem' }));
                const israelTimeElement = document.getElementById('israel-time');
                if (israelTimeElement) {
                    israelTimeElement.textContent = ilTime.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true });
                }

                // Running Time (simple counter for demonstration)
                const runningTimeElement = document.getElementById('running-time');
                if (runningTimeElement) {
                    let [minutes, seconds] = runningTimeElement.textContent.split(':').map(Number);
                    seconds++;
                    if (seconds === 60) {
                        seconds = 0;
                        minutes++;
                    }
                    runningTimeElement.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                }
            }

            // Update time every second
            setInterval(updateHeaderTime, 1000);
            // Initial call to display time immediately
            updateHeaderTime();

            // --- Event Listeners ---

            // Student Type Buttons (for Add Student form)
            if (regularStudentBtn) {
                regularStudentBtn.addEventListener('click', () => selectStudentType(regularStudentBtn, 'Regular Student', false));
            }
            if (trialStudentBtn) {
                trialStudentBtn.addEventListener('click', () => selectStudentType(trialStudentBtn, 'Trial Student', false));
            }

            // Student Type Buttons (for Edit Student Modal)
            if (editModalRegularStudentBtn) {
                editModalRegularStudentBtn.addEventListener('click', () => selectStudentType(editModalRegularStudentBtn, 'Regular Student', true));
            }
            if (editModalTrialStudentBtn) {
                editModalTrialStudentBtn.addEventListener('click', () => selectStudentType(editModalTrialStudentBtn, 'Trial Student', true));
            }

            // Present/Missed buttons in edit modal
            if (editModalPresentBtn) {
                editModalPresentBtn.addEventListener('click', () => selectModalAttendanceStatus(editModalPresentBtn, 'Present'));
            }

            if (editModalMissedBtn) {
                editModalMissedBtn.addEventListener('click', () => selectModalAttendanceStatus(editModalMissedBtn, 'Missed'));
            }


            // Clear All button
            if (clearAllBtn) {
                clearAllBtn.addEventListener('click', () => {
                    if (studentTableBody) {
                        studentTableBody.innerHTML = '';
                        studentCounter = 0;
                        studentTableBody.appendChild(noStudentsRow);
                    }
                    showMessage('All students cleared from the table.', 'success');
                    if (currentStudentNameSpan) currentStudentNameSpan.textContent = '';
                    if (currentStudentIdSpan) currentStudentIdSpan.textContent = '';
                    if (currentStudentTypeSpan) currentStudentTypeSpan.textContent = '';
                    if (currentStartTimeSpan) currentStartTimeSpan.textContent = '';
                });
            }


            // Add Student button (main form)
            if (addStudentBtn) {
                addStudentBtn.addEventListener('click', () => {
                    const studentName = studentNameInput.value.trim();
                    const studentId = studentIdInput.value.trim();
                    const scheduledTime = getScheduledTime(); // Automatically get scheduled time
                    const startTime = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });

                    if (!studentName) {
                        showMessage('Please enter student name.', 'error');
                        return;
                    }
                    if (!studentId) {
                        showMessage('Please enter student ID.', 'error');
                        return;
                    }
                    if (isNaN(studentId) || studentId === '') {
                        showMessage('Student ID must be a number.', 'error');
                        return;
                    }
                    if (!selectedStudentType) {
                        showMessage('Please select student type (Regular or Trial).', 'error');
                        return;
                    }

                    if (studentTableBody && studentTableBody.contains(noStudentsRow)) {
                        studentTableBody.removeChild(noStudentsRow);
                    }
                    studentCounter++;

                    const newRow = document.createElement('tr');
                    newRow.className = 'bg-white border-b hover:bg-gray-50';
                    newRow.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${studentCounter}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${selectedStudentType}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">00:00</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${studentName}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${studentId}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${scheduledTime}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">N/A</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            <button class="attendance-btn present">Present</button>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            <button class="text-blue-600 hover:text-blue-900 mr-2 edit-btn">Edit</button>
                            <button class="text-red-600 hover:text-red-900 delete-btn">Delete</button>
                        </td>
                    `;
                    if (studentTableBody) {
                        studentTableBody.appendChild(newRow);
                    }

                    // Update OFF SHIFT card details
                    if (currentStudentNameSpan) currentStudentNameSpan.textContent = studentName;
                    if (currentStudentIdSpan) currentStudentIdSpan.textContent = studentId;
                    if (currentStudentTypeSpan) currentStudentTypeSpan.textContent = selectedStudentType;
                    if (currentStartTimeSpan) currentStartTimeSpan.textContent = startTime;

                    showMessage('Student added successfully!', 'success');
                    
                    // Clear input fields and reset student type buttons after adding
                    if (studentNameInput) studentNameInput.value = '';
                    if (studentIdInput) studentIdInput.value = '';
                    selectedStudentType = '';
                    if (regularStudentBtn) {
                        regularStudentBtn.classList.remove('active', 'bg-blue-500', 'text-white');
                        regularStudentBtn.classList.add('bg-gray-200', 'text-gray-800');
                    }
                    if (trialStudentBtn) {
                        trialStudentBtn.classList.remove('active', 'bg-blue-500', 'text-white');
                        trialStudentBtn.classList.add('bg-gray-200', 'text-gray-800');
                    }
                });
            }


            // Event delegation for attendance, edit, and delete buttons (in table)
            if (studentTableBody) {
                studentTableBody.addEventListener('click', (event) => {
                    // Handle Attendance button click
                    if (event.target.classList.contains('attendance-btn')) {
                        const button = event.target;
                        if (button.classList.contains('present')) {
                            button.classList.remove('present');
                            button.classList.add('missed');
                            button.textContent = 'Missed';
                        } else {
                            button.classList.remove('missed');
                            button.classList.add('present');
                            button.textContent = 'Present';
                        }
                    }

                    // Handle Delete button click
                    if (event.target.classList.contains('delete-btn')) {
                        rowToDelete = event.target.closest('tr');
                        if (confirmationModal) {
                            confirmationModal.style.display = 'flex'; // Show the modal
                        }
                    }

                    // Handle Edit button click
                    if (event.target.classList.contains('edit-btn')) {
                        editingRow = event.target.closest('tr');
                        const cells = editingRow.querySelectorAll('td');
                        
                        // Populate modal fields
                        if (editModalStudentName) editModalStudentName.value = cells[3].textContent;
                        if (editModalStudentId) editModalStudentId.value = cells[4].textContent;
                        
                        // Parse and set student type in modal
                        const studentTypeInTable = cells[1].textContent;
                        selectStudentType(null, studentTypeInTable, true); // Pass null for button, as we're just setting internal state
                        if (studentTypeInTable === 'Regular Student' && editModalRegularStudentBtn) {
                            editModalRegularStudentBtn.classList.add('active', 'bg-blue-500', 'text-white');
                            editModalRegularStudentBtn.classList.remove('bg-gray-200', 'text-gray-800');
                        } else if (studentTypeInTable === 'Trial Student' && editModalTrialStudentBtn) {
                            editModalTrialStudentBtn.classList.add('active', 'bg-blue-500', 'text-white');
                            editModalTrialStudentBtn.classList.remove('bg-gray-200', 'text-gray-800');
                        }

                        // Parse and set time inputs in modal
                        const scheduledTimeInTable = cells[5].textContent; // e.g., "9:00 AM"
                        const timeDurationInTable = cells[2].textContent; // e.g., "00:00"

                        const parseTime = (timeStr) => {
                            const parts = timeStr.match(/(\d+):(\d{2}) (AM|PM)/);
                            if (parts) {
                                return { hour: parseInt(parts[1]), minute: parseInt(parts[2]), ampm: parts[3] };
                            }
                            return { hour: '', minute: '', ampm: 'AM' }; // Default if parsing fails
                        };

                        const parsedStartTime = parseTime(scheduledTimeInTable);
                        if (editModalStartTimeHour) editModalStartTimeHour.value = parsedStartTime.hour;
                        if (editModalStartTimeMinute) editModalStartTimeMinute.value = parsedStartTime.minute === '' ? '' : String(parsedStartTime.minute).padStart(2, '0');
                        if (editModalStartTimeAmpm) editModalStartTimeAmpm.value = parsedStartTime.ampm;

                        const parsedEndTime = parseTime(timeDurationInTable); // Assuming Time Duration is End Time
                        if (editModalEndTimeHour) editModalEndTimeHour.value = parsedEndTime.hour;
                        if (editModalEndTimeMinute) editModalEndTimeMinute.value = parsedEndTime.minute === '' ? '' : String(parsedEndTime.minute).padStart(2, '0');
                        if (editModalEndTimeAmpm) editModalEndTimeAmpm.value = parsedEndTime.ampm;

                        // Set attendance status in modal using the new function
                        const attendanceStatusInTable = cells[7].querySelector('.attendance-btn').textContent;
                        if (attendanceStatusInTable === 'Present') {
                            selectModalAttendanceStatus(editModalPresentBtn, 'Present');
                        } else { // Missed
                            selectModalAttendanceStatus(editModalMissedBtn, 'Missed');
                        }
                        
                        if (editStudentModal) {
                            editStudentModal.style.display = 'flex'; // Show the edit modal
                        }
                    }
                });
            }


            // Modal button event listeners (Confirmation Modal)
            if (confirmDeleteBtn) {
                confirmDeleteBtn.addEventListener('click', () => {
                    if (rowToDelete) {
                        const studentNameDeleted = rowToDelete.cells[3].textContent;
                        const studentIdDeleted = rowToDelete.cells[4].textContent;

                        // Check if the deleted student was the current student in the OFF SHIFT card
                        if (currentStudentNameSpan && currentStudentIdSpan &&
                            currentStudentNameSpan.textContent === studentNameDeleted &&
                            currentStudentIdSpan.textContent === studentIdDeleted) {
                            if (currentStudentNameSpan) currentStudentNameSpan.textContent = '';
                            if (currentStudentIdSpan) currentStudentIdSpan.textContent = '';
                            if (currentStudentTypeSpan) currentStudentTypeSpan.textContent = '';
                            if (currentStartTimeSpan) currentStartTimeSpan.textContent = '';
                        }

                        rowToDelete.remove();
                        showMessage('Student record deleted successfully!', 'success');
                        
                        // If table is empty after deletion, re-add "No students added yet" row
                        if (studentTableBody && studentTableBody.children.length === 0) {
                            studentTableBody.appendChild(noStudentsRow);
                        }
                    }
                    if (confirmationModal) {
                        confirmationModal.style.display = 'none'; // Hide the modal
                    }
                    rowToDelete = null; // Clear reference
                });
            }

            if (cancelDeleteBtn) {
                cancelDeleteBtn.addEventListener('click', () => {
                    if (confirmationModal) {
                        confirmationModal.style.display = 'none'; // Hide the modal
                    }
                    rowToDelete = null; // Clear reference
                });
            }

            // Modal button event listeners (Edit Student Modal)
            if (submitEditBtn) {
                submitEditBtn.addEventListener('click', () => {
                    console.log("Submit button clicked!"); // Debugging log
                    const studentName = editModalStudentName.value.trim();
                    const studentId = editModalStudentId.value.trim();
                    const studentType = currentEditModalStudentType; // Get from modal's selected type

                    // Validate Student Name and ID
                    if (!studentName) {
                        showMessage('Please enter student name.', 'error');
                        return;
                    }
                    if (!studentId) {
                        showMessage('Please enter student ID.', 'error');
                        return;
                    }
                    if (isNaN(studentId) || studentId === '') {
                        showMessage('Student ID must be a number.', 'error');
                        return;
                    }
                    if (!studentType) {
                        showMessage('Please select student type (Regular or Trial) in the modal.', 'error');
                        return;
                    }

                    // Validate Start Time
                    const startTimeValidation = validateModalTime(
                        editModalStartTimeHour.value,
                        editModalStartTimeMinute.value,
                        editModalStartTimeAmpm.value,
                        'start'
                    );
                    if (!startTimeValidation.isValid) {
                        showMessage(`Start Time Error: ${startTimeValidation.message}`, 'error');
                        return;
                    }
                    const formattedStartTime = startTimeValidation.formattedTime;

                    // Validate End Time
                    const endTimeValidation = validateModalTime(
                        editModalEndTimeHour.value,
                        editModalEndTimeMinute.value,
                        editModalEndTimeAmpm.value,
                        'end'
                    );
                    if (!endTimeValidation.isValid) {
                        showMessage(`End Time Error: ${endTimeValidation.message}`, 'error');
                        return;
                    }
                    const formattedEndTime = endTimeValidation.formattedTime;

                    // Update the editing row
                    if (editingRow) {
                        console.log("Updating row:", editingRow); // Debugging log
                        console.log("New Student Name:", studentName);
                        console.log("New Student ID:", studentId);
                        console.log("New Student Type:", studentType);
                        console.log("Formatted Start Time:", formattedStartTime);
                        console.log("Formatted End Time:", formattedEndTime);
                        console.log("New Attendance Status:", currentEditModalAttendanceStatus);

                        const cells = editingRow.querySelectorAll('td');
                        if (cells.length > 0) { // Ensure cells exist
                            cells[1].textContent = studentType;
                            cells[2].textContent = formattedEndTime; // Time Duration
                            cells[3].textContent = studentName;
                            cells[4].textContent = studentId;
                            cells[5].textContent = formattedStartTime; // Scheduled Time
                            
                            const attendanceButton = cells[7].querySelector('.attendance-btn');
                            if (attendanceButton) {
                                attendanceButton.textContent = currentEditModalAttendanceStatus;
                                attendanceButton.classList.remove('present', 'missed', 'neutral'); // Remove all states
                                attendanceButton.classList.add(currentEditModalAttendanceStatus.toLowerCase()); // Add correct state
                            }
                        } else {
                            console.error("No cells found in editing row!");
                        }

                        // Update OFF SHIFT card if this was the current student
                        if (currentStudentNameSpan && currentStudentIdSpan &&
                            currentStudentNameSpan.textContent === cells[3].textContent &&
                            currentStudentIdSpan.textContent === cells[4].textContent) {
                            if (currentStudentNameSpan) currentStudentNameSpan.textContent = studentName;
                            if (currentStudentIdSpan) currentStudentIdSpan.textContent = studentId;
                            if (currentStudentTypeSpan) currentStudentTypeSpan.textContent = studentType;
                            // Start Time in OFF SHIFT card is the actual time student was added, not scheduled time
                            // For simplicity, we'll keep it as the original 'startTime' from when it was added, or update if the user wants.
                            // For now, it will remain the original start time from when the student was added.
                        }

                        showMessage('Student information updated successfully!', 'success');
                    } else {
                        console.error("editingRow is null. Cannot update student.");
                    }

                    // Hide modal and reset
                    if (editStudentModal) editStudentModal.style.display = 'none';
                    editingRow = null;
                    currentEditModalStudentType = ''; // Reset modal's selected type
                    currentEditModalAttendanceStatus = 'Present'; // Reset for next edit
                });
            }

            if (cancelEditBtn) {
                cancelEditBtn.addEventListener('click', () => {
                    if (editStudentModal) editStudentModal.style.display = 'none';
                    editingRow = null;
                    currentEditModalStudentType = ''; // Reset modal's selected type
                    currentEditModalAttendanceStatus = 'Present'; // Reset for next edit
                });
            }
        });
    </script>
</body>
</html>
